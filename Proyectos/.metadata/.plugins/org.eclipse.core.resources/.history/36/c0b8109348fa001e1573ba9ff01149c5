#include "MAX31865_lib.h"

void MAX31865_Init(uint8_t num_wires) {
	uint8_t MAX31865_Reinitialization_cnt = 0;
	MAX31865_Sensor_Error = 0;
	uint8_t MAX31865_Configuration_register_write[] = { 0x80, 0x00 };

	if (num_wires == 2 || num_wires == 4) {
		MAX31865_Configuration_register_write[1] = 0xC3; //0xC3
	} else if (num_wires == 3) {
		MAX31865_Configuration_register_write[1] = 0xD3; //0xD3
	}
	cs_set();
	HAL_SPI_Transmit(&hspi1, MAX31865_Configuration_register_write, 2, 100);
	cs_reset();

	while (MAX31865_Configuration_info() != 0xD1
			&& MAX31865_Configuration_info() != 0xC1) {
		MAX31865_Reinitialization_cnt++;

		cs_set();
		HAL_SPI_Transmit(&hspi1, MAX31865_Configuration_register_write, 2, 100);
		cs_reset();

		if (MAX31865_Reinitialization_cnt == 100) {
			//printf("Initialization MAX31865 != OK\r\n");
			break;
		}

	}
}

uint8_t MAX31865_Configuration_info(void);
double MAX31865_Get_Temperature(void);
double MAX31865_Get_Temperature_math(double PT100_Resistance);
